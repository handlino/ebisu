<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"></meta>
    <script src="../lib/jquery-1.2.js"></script>
    <script src="../lib/Ebisu.js"></script>
    <title>Chase</title>
<style type="text/css">
body {
    background:black;
    color:white;
}
.chaser {
    -moz-border-radius: 100px;
    width: 10px;
    height:10px;
    position:absolute;
    background:#fff;
    color:red;
    z-index: 5;
}
#field {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
    overflow: hidden;
    width: 100%;
    height: 100%;
};

</style>
  </head>
  <body>
    <p>Move your mouse randomly.</p>
    <div id="field"></div>
    <script type="text/javascript">

var gwidth = $(window).width() - 200;
var gheight = $(window).height() - 200;

var total = 10;
for(var i = 0;i < total; i++) {
    $("<div class='chaser' id='chaser-" + i + "'></div>").appendTo("#field");
}

$(document).ready(function($) {
    var mouse_x;
    var mouse_y;
    var mouse_x2;
    var mouse_y2;

    var mouse_still = true;
    $("#field").mousemove(
        function(e) {
            mouse_x = e.clientX;
            mouse_y = e.clientY;

            (function(x, y) {
                setTimeout(function() {
                    Ebisu("mouse near 0").trigger(x,y);
                },0);
            })(e.clientX, e.clientY);
        }
    );

    Ebisu("mouse still").attach(function(x, y) {
        Ebisu("mouse near 0").trigger(mouse_x, mouse_y);
    });

    setInterval(function() {
        var still = true;
        if (mouse_x != mouse_x2) {
            mouse_x2 = mouse_x;
            still = false;
        }
        if (mouse_y != mouse_y2) {
            mouse_y2 = mouse_y;
            still = false;
        }
        if (still == true) {
            Ebisu("mouse still").trigger(mouse_x, mouse_y);
        }
    }, 25);

    var chase =  function(loc_x, loc_y) {
        var self = this;
        var x = this.offsetLeft;
        var y = this.offsetTop;
        var v  = 1/(1+i);
        var dx = loc_x - x;
        var dy = loc_y - y;
        $(this).css({ left: x + dx * v, top: y + dy * v })
    }

    for(var i = 0; i < total; i++) {
        Ebisu("mouse near " + i).to( jQuery("#chaser-" + i)[0] ).attach(
            (function(i) {
                return function(x, y) {
                    chase.apply(this, [x, y]);
                    setTimeout(function() {
                        Ebisu("mouse near " + (i+1)).trigger(x, y);
                    }, 100);
                }
            })(i)
        );
    }


});


    </script>
  </body>
</html>
