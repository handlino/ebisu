<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf8"></meta>
    <script src="../lib/jquery-1.2.js"></script>
    <script src="../lib/Ebisu.js"></script>
    <title>Spread</title>
<style type="text/css">
body {
    background:black;
}
.fire {
    width:2px;
    height:2px;
    border:1px solid #999;
    position:absolute;
    bottom:0;
    right:0;
    background:#fff;
    color:red;
}
a#fire {
    float:right;
    font-size:24pt;
    color:white;
}
</style>
  </head>
  <body>
    <a id="fire" href="#">Click Here to start</a>
    <div id="sky"></div>
    <script type="text/javascript">

var gwidth = $(window).width() - 30;
var gheight = $(window).height() - 30;
var total = 1800;
for(var i = 0;i < total; i++) {
    $("<div class='fire'> </div>").appendTo("#sky");
}

$("div.fire").css({
    'left': gwidth,
    'top': gheight
});

function texture(i, power) {
    var left = gwidth/2 + i * Math.pow(Math.sin(i), power) % gwidth/2 ;
    var top  = gheight/2 + i * Math.pow(Math.cos(i), power) % gheight/2 ;
    return [left, top];
}

Ebisu("fire").to('div.fire').attach(
    function() {
        var power = 1 + (Math.random() * 7 | 0) * 2;
        $("#fire").append("<br>type " + power);
        this.each(
            function(i) {
                var [left, top] = texture(i, power);
                var self = this;
                setTimeout(
                    function() {
                        $(self).animate(
                            {
                                'left': left,
                                'top': top
                            },
                            1000
                        )
                    },
                    i * 10
                );
            }
        );
    }
);

Ebisu("unfire").to('div.fire').attach(function() {
    this.css({
        'left': gwidth,
        'top': gheight
    });
})

var do_spread = function() {
    $("#fire").unbind("click").click(undo_spread)
    .text("Click Here To Revert");
    Ebisu("fire").trigger();
};

var undo_spread = function() {
    $("#fire").unbind("click").click(do_spread)
    .text("Click Here To Start");
    Ebisu("unfire").trigger();
}

$("#fire").click(do_spread);

    </script>
  </body>
</html>
